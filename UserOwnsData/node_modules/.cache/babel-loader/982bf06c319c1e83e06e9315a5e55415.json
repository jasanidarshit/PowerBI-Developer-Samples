{"ast":null,"code":"/*! @azure/msal-common v13.3.3 2024-06-06 */\n'use strict';\n\nimport { ClientAuthError } from '../error/ClientAuthError.js';\nimport { StringUtils } from '../utils/StringUtils.js';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\n\n/**\r\n * JWT Token representation class. Parses token string and generates claims object.\r\n */\n\nvar AuthToken =\n/** @class */\nfunction () {\n  function AuthToken(rawToken, crypto) {\n    if (StringUtils.isEmpty(rawToken)) {\n      throw ClientAuthError.createTokenNullOrEmptyError(rawToken);\n    }\n\n    this.rawToken = rawToken;\n    this.claims = AuthToken.extractTokenClaims(rawToken, crypto);\n  }\n  /**\r\n   * Extract token by decoding the rawToken\r\n   *\r\n   * @param encodedToken\r\n   */\n\n\n  AuthToken.extractTokenClaims = function (encodedToken, crypto) {\n    var decodedToken = StringUtils.decodeAuthToken(encodedToken); // token will be decoded to get the username\n\n    try {\n      var base64TokenPayload = decodedToken.JWSPayload; // base64Decode() should throw an error if there is an issue\n\n      var base64Decoded = crypto.base64Decode(base64TokenPayload);\n      return JSON.parse(base64Decoded);\n    } catch (err) {\n      throw ClientAuthError.createTokenParsingError(err);\n    }\n  };\n  /**\r\n   * Determine if the token's max_age has transpired\r\n   */\n\n\n  AuthToken.checkMaxAge = function (authTime, maxAge) {\n    /*\r\n     * per https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest\r\n     * To force an immediate re-authentication: If an app requires that a user re-authenticate prior to access,\r\n     * provide a value of 0 for the max_age parameter and the AS will force a fresh login.\r\n     */\n    var fiveMinuteSkew = 300000; // five minutes in milliseconds\n\n    if (maxAge === 0 || Date.now() - fiveMinuteSkew > authTime + maxAge) {\n      throw ClientAuthError.createMaxAgeTranspiredError();\n    }\n  };\n\n  return AuthToken;\n}();\n\nexport { AuthToken };","map":{"version":3,"sources":["../../src/account/AuthToken.ts"],"names":[],"mappings":";;;;;AAAA;;;AAGG;;AAQH;;AAEG;;AACH,IAAA,SAAA;AAAA;AAAA,YAAA;AAMI,WAAY,SAAZ,CAAY,QAAZ,EAA8B,MAA9B,EAA6C;AACzC,QAAI,WAAW,CAAC,OAAZ,CAAoB,QAApB,CAAJ,EAAmC;AAC/B,YAAM,eAAe,CAAC,2BAAhB,CAA4C,QAA5C,CAAN;AACH;;AAED,SAAK,QAAL,GAAgB,QAAhB;AACA,SAAK,MAAL,GAAc,SAAS,CAAC,kBAAV,CAA6B,QAA7B,EAAuC,MAAvC,CAAd;AACH;AAED;;;;AAIG;;;AACI,EAAA,SAAA,CAAA,kBAAA,GAAP,UAA0B,YAA1B,EAAgD,MAAhD,EAA+D;AAE3D,QAAM,YAAY,GAAqB,WAAW,CAAC,eAAZ,CAA4B,YAA5B,CAAvC,CAF2D,C;;AAK3D,QAAI;AACA,UAAM,kBAAkB,GAAG,YAAY,CAAC,UAAxC,CADA,C;;AAIA,UAAM,aAAa,GAAG,MAAM,CAAC,YAAP,CAAoB,kBAApB,CAAtB;AACA,aAAO,IAAI,CAAC,KAAL,CAAW,aAAX,CAAP;AACH,KAND,CAME,OAAO,GAAP,EAAY;AACV,YAAM,eAAe,CAAC,uBAAhB,CAAwC,GAAxC,CAAN;AACH;AACJ,GAdM;AAgBP;;AAEG;;;AACI,EAAA,SAAA,CAAA,WAAA,GAAP,UAAmB,QAAnB,EAAqC,MAArC,EAAmD;AAC/C;;;;AAIG;AACH,QAAM,cAAc,GAAG,MAAvB,CAN+C,CAMjB;;AAC9B,QAAK,MAAM,KAAK,CAAZ,IAAoB,IAAI,CAAC,GAAL,KAAa,cAAd,GAAiC,QAAQ,GAAG,MAAnE,EAA6E;AACzE,YAAM,eAAe,CAAC,2BAAhB,EAAN;AACH;AACJ,GAVM;;AAWX,SAAC,SAAD;AAAC,CAlDD,EAAA","sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { TokenClaims } from \"./TokenClaims\";\r\nimport { DecodedAuthToken } from \"./DecodedAuthToken\";\r\nimport { ClientAuthError } from \"../error/ClientAuthError\";\r\nimport { StringUtils } from \"../utils/StringUtils\";\r\nimport { ICrypto } from \"../crypto/ICrypto\";\r\n\r\n/**\r\n * JWT Token representation class. Parses token string and generates claims object.\r\n */\r\nexport class AuthToken {\r\n\r\n    // Raw Token string\r\n    rawToken: string;\r\n    // Claims inside token\r\n    claims: TokenClaims;\r\n    constructor(rawToken: string, crypto: ICrypto) {\r\n        if (StringUtils.isEmpty(rawToken)) {\r\n            throw ClientAuthError.createTokenNullOrEmptyError(rawToken);\r\n        }\r\n\r\n        this.rawToken = rawToken;\r\n        this.claims = AuthToken.extractTokenClaims(rawToken, crypto);\r\n    }\r\n\r\n    /**\r\n     * Extract token by decoding the rawToken\r\n     *\r\n     * @param encodedToken\r\n     */\r\n    static extractTokenClaims(encodedToken: string, crypto: ICrypto): TokenClaims {\r\n\r\n        const decodedToken: DecodedAuthToken = StringUtils.decodeAuthToken(encodedToken);\r\n\r\n        // token will be decoded to get the username\r\n        try {\r\n            const base64TokenPayload = decodedToken.JWSPayload;\r\n\r\n            // base64Decode() should throw an error if there is an issue\r\n            const base64Decoded = crypto.base64Decode(base64TokenPayload);\r\n            return JSON.parse(base64Decoded) as TokenClaims;\r\n        } catch (err) {\r\n            throw ClientAuthError.createTokenParsingError(err);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Determine if the token's max_age has transpired\r\n     */\r\n    static checkMaxAge(authTime: number, maxAge: number): void {\r\n        /*\r\n         * per https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest\r\n         * To force an immediate re-authentication: If an app requires that a user re-authenticate prior to access,\r\n         * provide a value of 0 for the max_age parameter and the AS will force a fresh login.\r\n         */\r\n        const fiveMinuteSkew = 300000; // five minutes in milliseconds\r\n        if ((maxAge === 0) || ((Date.now() - fiveMinuteSkew) > (authTime + maxAge))) {\r\n            throw ClientAuthError.createMaxAgeTranspiredError();\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}